## 目录

*   [关于](#关于)

    *   [运行环境](#运行环境)

    *   [功能](#功能)

*   [严肃警告](#严肃警告)

*   [安装教程](#安装教程)

    *   [一、刷入带有UA2F的固件](#一刷入带有ua2f的固件)

        *   [1.刷入 Breed Web 恢复控制台](#1刷入-breed-web-恢复控制台请自行百度)

        *   [2.进入 Breed Web 恢复控制台](#2进入-breed-web-恢复控制台此处以新三为例其他路由器请自行搜索)

        *   [3.刷入固件](#3刷入固件)

    *   [二、路由器设置](#二路由器设置)

        *   [1.配置时间](#1配置时间)

        *   [2.配置wan口](#2配置wan口)

        *   [3.配置lan口](#3配置lan口可选若路由器出现网页加载慢但app可以正常访问网络的情况就配置)

        *   [4.配置WIFI](#4配置wifi)

        *   [5.配置管理界面（SSH）密码](#5配置管理界面ssh密码)

    *   [三、安装SGU-Script](#三安装sgu-script)

        *   [1.cli（命令行版本）](#1cli命令行版本)

        *   [2.gui（可视化界面版本）](#2gui可视化界面版本)

        *   [3.插上网线](#3插上网线)

*   [验证网络](#验证网络)

*   [SGU-Script配置命令](#sgu-script配置命令)

    *   [OpenWrt](#OpenWrt)

*   [添砖加瓦](#添砖加瓦)

*   [故障排除](#故障排除)

# SGU-Script

# 关于

## 运行环境

*   cli版需要jdk17

*   gui版需要windows7及以上

***

## 功能

1.  SGU-Script是一款免费开源的路由器锐捷认证设置程序，本质是自动配置登录脚本

2.  主要是为了应对2022年韶关学院新上网认证，目前只支持搭载OpenWrt的路由器配置

3.  并且Openwrt需已安装curl或wget模块，未安装的设备请先自行安装该模块

4.  您也可以自行克隆项目，并添加对其他系统的支持

5.  SGU-Script会实时监控您的网络状况，在掉线的时候进行自动重连，但并不能阻止共享上网的检查

6.  由于阻止共享上网的监测较为复杂，需您自行编译固件，并添加相应的插件支持

7.  此处提供一个笔记以解决共享上网的解决方案（首推UA2F）

    <https://www.notion.so/OpenWrt-f59ae1a76741486092c27bc24dbadc59>

8.  当然本项目也会助力您突破共享上网限制（在`firmware分支`中有我编译好带`UA2F`的固件，但我不可能做到所有设备都适配，希望大家能够编译更多的固件放在`firmware分支`，然后给我提一个Pr）

9.  下文安装教程也会教你如何安装固件

10.  若您不需要防止共享上网限制的话，直接看【安装教程】-【路由器设置】&&【安装SGU-Script】即可

***

# 严肃警告

*   SGU-Script只为学习研发，若您对该程序有异议，可至github项目提起issue

*   原则上该项目不允许被投入商业用途，但如果有人使用该项目售卖路由器的话，产生一切后果与本项目无关

*   请大家有能力的可以好好钻研一下本项目，教程写的已经蛮详细了，实在有非科班（纯小白）的，建议还是找人买一台装好的吧

*   若您使用本程序则默认遵循MIT license，祝您使用愉快

***

# 安装教程

## 一、刷入带有UA2F的固件

Eg：当然如果你的有UA2F的ipk包可用，也可以直接安装ipk包，但是UA2F挑内核，可能会安装失败

### 1.刷入 Breed Web 恢复控制台（请自行百度）

*   已刷入 Breed Web 恢复控制台的请继续下一步

### 2.进入 Breed Web 恢复控制台（此处以新三为例，其他路由器请自行搜索）

1.  将网线的一端插在lan口上（黄色的网口），另一端插电脑

2.  在`电源线`的旁边有一个小小的按钮，记住它（下文中我们称之为`RESET键`）

3.  拔掉`电源线`，按下`RESET键`（不松开）

4.  插上`电源线`（`RESET键`依旧不松开）

5.  等待8-9秒，松开`RESET键`

### 3.刷入固件

*   电脑打开浏览器，进入[192.168.1.1](http://192.168.1.1/ "192.168.1.1")，打不开的话可以拔插网线试试

*   不出所料的话你会进入以下界面

    ![输入图片说明](https://foruda.gitee.com/images/1663297371049361815/7bd18772_9532490.png "屏幕截图")

*   之后我们选择【恢复出厂设置】-【Config 区 (公版)】&【Config 区 (精简)】-【执行】

    ![输入图片说明](https://foruda.gitee.com/images/1663297409657314632/070de81b_9532490.png "屏幕截图")

*   执行成功后，如图依次点击，上传带UA2F的固件，并更新（我会在`firmware分支`中提交我编译好带UA2F的固件），此处需注意，并非所有的机型的闪存布局都是使用公版，因此在刷固件之前请认真查看【info.txt】中的信息

    ![输入图片说明](https://foruda.gitee.com/images/1663297441527490903/1bef0810_9532490.png "屏幕截图")

*   显示此界面时固件就安装成功了，等待路由器开机（2-3分钟）

    ![输入图片说明](https://foruda.gitee.com/images/1663297451573275143/3f439994_9532490.png "屏幕截图")

## 二、路由器设置

Eg：请注意以下每一步配置都请记得保存并应用，下文将不会再提醒您

### 1.配置时间

1.  路由器开机后，依旧在浏览器输入[192.168.1.1](http://192.168.1.1/ "192.168.1.1")，新三固件默认密码为`password`

    ![输入图片说明](https://foruda.gitee.com/images/1665910528991744701/afc45c9f_9532490.jpeg "屏幕截图")

2.  进入路由器管理界面后，如图进入【系统】-【系统】-【同步浏览器时间】

    ![输入图片说明](https://foruda.gitee.com/images/1663341545505138629/462efb9d_9532490.png "屏幕截图")

### 2.配置wan口

1.  进入【网络】-【接口】-【删除掉wan6】

    ![输入图片说明](https://foruda.gitee.com/images/1663297487690348966/5578b3b0_9532490.png "屏幕截图")

2.  我们将协议切换为静态地址，并点击【切换协议】

    ![输入图片说明](https://foruda.gitee.com/images/1663297503153102559/ea201584_9532490.png "屏幕截图")

3.  依次填入IP地址，子网掩码，网关（这三个值在统一认证平台中可以查到，在网管保修那里），DNS推荐使用阿里的，`223.5.5.5`，`223.6.6.6`

    ![输入图片说明](https://foruda.gitee.com/images/1663297520784451144/d3dd0eb0_9532490.png "屏幕截图")

### 3.配置lan口(可选，若路由器出现网页加载慢，但app可以正常访问网络的情况就配置)

1.  进入【网络】-【接口】-【LAN】

    ![输入图片说明](https://foruda.gitee.com/images/1663297532367882639/900f57e9_9532490.png "屏幕截图")

2.  滑到最下面的【高级设置】-【DHCP选项】，设置`6,223.5.5.5,223.6.6.6`，注意逗号和点，向lan口设备通告DNS

    ![输入图片说明](https://foruda.gitee.com/images/1663297544988861738/b1829822_9532490.png "屏幕截图")

### 4.配置WIFI

*   进入【网络】-【无线】页面

    ![输入图片说明](https://foruda.gitee.com/images/1663297555042037423/cdb6ea36_9532490.png "屏幕截图")

*   新三有【2.412 GHz】和【5.180 GHz】两个频段，这里通俗的讲解下

    1.  2.412 GHz：信号好，穿墙能力强，但是负载网速慢

    2.  5.180 GHz：信号良，穿墙能力差，但是负载网速快

*   配置`2.412 GHz` WIFI

    1.  进入2.412 GHz`WIFI`配置界面

        ![输入图片说明](https://foruda.gitee.com/images/1663297699468672712/cba1b02d_9532490.png "屏幕截图")

    2.  滑到最下面，给你的`WIFI`设置一个骚名字

        ![输入图片说明](https://foruda.gitee.com/images/1663297597104062427/5d3f0469_9532490.png "屏幕截图")

    3.  给你的`WIFI`设置一个安全密码，加密方式推荐使用`WPA-PSK/WPA2-PSK Mixed Mode`，更好地兼容旧设备

        ![输入图片说明](https://foruda.gitee.com/images/1663297612732477481/8b5b1674_9532490.png "屏幕截图")

*   配置`5.180 GHz` WIFI

    1.  进入5.180 GHz`WIFI`配置界面

        ![输入图片说明](https://foruda.gitee.com/images/1663297624926752456/1e39e5c1_9532490.png "屏幕截图")

    2.  剩余步骤与`2.412 GHz`形同，

    3.  如果你希望自己选择使用`2.412 GHz`或`5.180 GHz`的话，你可以将`5.180 GHz`的WIFI名设置与`2.412 GHz`不同，这样你可以通过不同WiFi名来切换使用`2.412 GHz`或`5.180 GHz`

    4.  如果你希望手机自己选择的话，可以将两个WIFI名设置一样的（我也建议这样做）

    5.  但是不管你选择哪样，我都强烈建议你将`5.180 GHz`的`WIFI`加密方式设置为更安全的`WPA2-PSK/WPA3-SAE Mixed Mode`，以此来提高安全性

    6.  但由于旧设备只能连接`2.412 GHz`，并且不支持最新的`WPA3`加密认证，于是我建议`2.412 GHz`的频段使用`WPA-PSK/WPA2-PSK Mixed Mode`加密

### 5.配置管理界面（SSH）密码

*   至此路由器设置全部设置完毕（但是原版OpenWrt可能需要您更改SSH隧道的密码，才可以使用SSH，因此你需要在【系统】-【管理权】中修改，同时你的路由器管理界面密码也会被对应修改）

    ![输入图片说明](https://foruda.gitee.com/images/1663297647435896974/ca43bfc5_9532490.png "屏幕截图")

## 三、安装SGU-Script

### 1.cli（命令行版本）

*   拥有`jre`环境，使用`java -jar SGU-Script.jar`命令来启动程序

*   或者用压缩包自带的`jre`，使用`.\jre\bin\java.exe -jar .\SGU-Script.jar`命令来启动程序，不同系统请注意分隔符

*   跟着提示完成操作即可

    ![输入图片说明](https://foruda.gitee.com/images/1663297657961594820/3cf3d86a_9532490.png "屏幕截图")

### 2.gui（可视化界面版本）

*   双击`SGU-Script.exe`文件运行，跟着提示完成操作即可

    ![输入图片说明](https://foruda.gitee.com/images/1663297663879995694/746a0914_9532490.png "屏幕截图")

### 3.插上网线

*   全部设置完成后，请将网线把wan口（即蓝色的口）与桌子底下的网口连起来

***

# 验证网络

1.  SGU-Script安装完毕后，理论上脚本就会自动去尝试登录账号（如果还是没有网络请查看日志）

2.  你可以在/var/log/sgu_script.log中查看到日志，或直接使用软件查看
    
3.  若提醒你账号已在线，可能是账号在脚本登录之前就已经登录过了，或者被别人登录了，你可以尝试在自助中心下线设备【我的设备】-【下线】，自助中心需要内网才能打开

    <https://172.16.253.92:8443/selfservice/>
    
4.  若被检测到共享，请验证`UA2F`防共享是否运行正常，打开下面的链接，若真实UA是一堆`F`，则说明`UA2F`运行正常，第一次使用本脚本时，可能会被检测共享，但之后次数会减少，因为修改的UA也会被视为新设备

    <http://ua.233996.xyz/>
    
5.  据作者所说，`UA2F`可能会和`mwan3`与`Flow Offloading`冲突，若您的`UA2F`存在频繁掉的现象请尝试关闭`mwan3`与`Flow Offloading`，分别在【网络】-【负载均衡】与【网络】-【Turbo ACC 网络加速】-【软件流量分载】/【硬件流量分载】

6.  腾讯系软件/游戏（LOL、CF、和平精英、王者荣耀等）中的网络加速服务会绕过UA2F，在一大段时间内只能登录一个号，否则将导致网络被封禁，可尝试关闭软件中的网络加速服务，或者直接使用流量游玩游戏

***

# SGU-Script配置命令

您可以使用命令来控制`SGU-Script`

## OpenWrt

1.  **启动脚本**  `/etc/init.d/sgu_script start`

2.  **停止脚本**  `/etc/init.d/sgu_script stop`

3.  **重启脚本**  `/etc/init.d/sgu_script restart`

***

# 添砖加瓦

SGU-Script目前只支持Openwrt系统的脚本安装，但是由于程序主函数部分采用反射机制完成

可以轻松地拓展更多的系统支持，具体操作如下

1.  在`cn.rabig.cli.controller.BaseSystem.systemList`中添加系统名称

2.  并在`cn.rabig.cli.controller`中创建对应的系统类并实现`BaseSystem`接口，依次实现接口中的方法

3.  在`src/main/resources/script/systemName`中创建对应的shell脚本（变量使用{}占位，FileUtils中的`writeSGUScript`方法可以为占位符赋值）

4.  CLI以及GUI主函数部分不需要改动，对应的下拉框新选项以及安装提示会自动生成，方法将会通过反射调用，只需要实现`BaseSystem`接口中的方法即可

***

# 故障排除

欢迎pr，欢迎fork

有任何问题欢迎在Issues中提出，或者通过邮箱[rabig@foxmail.com](mailto:rabig@foxmail.com "rabig@foxmail.com")联系我
